<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç©ºã‚’èª­ã‚€</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
body{font-family:"Noto Serif JP","æ¸¸æ˜æœ",serif;min-height:100dvh;color:#fff;overflow-x:hidden;transition:background 1s ease;background:linear-gradient(170deg,#4a6a80 0%,#3a5068 50%,#2a4058 100%)}
body.weather-clear{background:linear-gradient(170deg,#4a90c2 0%,#2a6fa0 40%,#1a5080 100%)}
body.weather-sunny{background:linear-gradient(170deg,#5a9acc 0%,#3a7aaa 40%,#2a6090 100%)}
body.weather-cloudy{background:linear-gradient(170deg,#7a8a98 0%,#5a6a78 50%,#4a5a68 100%)}
body.weather-fog{background:linear-gradient(170deg,#8a9098 0%,#6a7880 50%,#5a6870 100%)}
body.weather-drizzle{background:linear-gradient(170deg,#5a7a90 0%,#3a5a70 50%,#2a4a60 100%)}
body.weather-rain{background:linear-gradient(170deg,#4a6a80 0%,#3a5068 50%,#2a4058 100%)}
body.weather-snow{background:linear-gradient(170deg,#8a9aaa 0%,#6a7a8a 50%,#5a6a7a 100%)}
body.weather-thunder{background:linear-gradient(170deg,#3a4a5a 0%,#2a3040 50%,#1a2030 100%)}
.main{min-height:100dvh;display:flex;flex-direction:column;padding:3rem 1.5rem 1.5rem;animation:fadeIn 1s ease}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.location{text-align:center;font-size:.85rem;font-weight:300;letter-spacing:.3em;color:rgba(255,255,255,.85)}
.weather-section{text-align:center;margin-top:1.5rem}
.weather-icon{font-size:3rem;line-height:1.2}
.temperature{font-size:1.4rem;font-weight:300;margin-top:.3rem;color:rgba(255,255,255,.95)}
.quote-section{flex:1;display:flex;align-items:center;justify-content:center;padding:1.5rem 0;overflow-x:auto}
.quote-text{writing-mode:vertical-rl;text-orientation:mixed;font-size:clamp(.95rem,2.5vw,1.1rem);font-weight:400;line-height:2.2;letter-spacing:.08em;max-height:70vh}
.quote-meta{text-align:center;font-size:.8rem;font-weight:300;color:rgba(255,255,255,.7);margin-bottom:1.5rem}
.quote-author{margin-right:.3em}
.quote-title::before{content:"ã€"}.quote-title::after{content:"ã€"}
.footer{border-top:1px solid rgba(255,255,255,.15);padding-top:1rem}
.footer-date{display:flex;justify-content:space-between;font-size:.8rem;font-weight:300;color:rgba(255,255,255,.7);margin-bottom:.8rem}
.hourly{display:flex;overflow-x:auto;scrollbar-width:none}
.hourly::-webkit-scrollbar{display:none}
.hour-item{flex:0 0 auto;width:3.5rem;text-align:center;font-weight:300;color:rgba(255,255,255,.8)}
.hour-item.now{color:#fff;font-weight:400}
.hour-label{font-size:.7rem;margin-bottom:.3rem}
.hour-icon{font-size:1.1rem;margin-bottom:.2rem}
.hour-temp{font-size:.75rem}
.hour-precip{font-size:.6rem;color:rgba(150,200,255,.8);margin-top:.1rem}
@media(min-width:600px){.main{max-width:480px;margin:0 auto}}
  </style>
</head>
<body>
  <main class="main" id="main">
    <div class="location" id="location-info"></div>
    <section class="weather-section">
      <div class="weather-icon" id="weather-icon"></div>
      <div class="temperature" id="temperature"></div>
    </section>
    <section class="quote-section">
      <blockquote class="quote-text" id="quote-text"></blockquote>
    </section>
    <div class="quote-meta">
      <span class="quote-author" id="quote-author"></span>
      <span class="quote-title" id="quote-title"></span>
    </div>
    <footer class="footer">
      <div class="footer-date" id="footer-date"></div>
      <div class="hourly" id="hourly"></div>
    </footer>
  </main>

<script>
// --- å¼•ç”¨ãƒ‡ãƒ¼ã‚¿ ---
const quotes = {
  clear: [
    { text: "ã•ã‚ã‚„ã‹ãªä¹æœˆä¸€æ—¥ã®æœã§ã—ãŸã€‚é’ãã‚‰ã§é¢¨ãŒã©ã†ã¨é³´ã‚Šã€æ—¥å…‰ã¯é‹å‹•å ´ã„ã£ã±ã„ã§ã—ãŸã€‚", author: "å®®æ²¢è³¢æ²»", title: "é¢¨ã®åˆä¸‰éƒ" },
    { text: "éœ§ãŒãµã£ã¨åˆ‡ã‚Œã¾ã—ãŸã€‚æ—¥ã®å…‰ãŒã•ã£ã¨æµã‚Œã¦ã¯ã„ã‚Šã¾ã—ãŸã€‚è‰ã‹ã‚‰ã¯ã—ãšããŒãã‚‰ãã‚‰è½ã¡ã€ã™ã¹ã¦ã®è‘‰ã‚‚èŒã‚‚èŠ±ã‚‚ã€ã“ã¨ã—ã®çµ‚ã‚ã‚Šã®æ—¥ã®å…‰ã‚’å¸ã£ã¦ã„ã¾ã™ã€‚", author: "å®®æ²¢è³¢æ²»", title: "é¢¨ã®åˆä¸‰éƒ" },
    { text: "ã‚ã‚‹æ—¥ã®äº‹ã§ã”ã–ã„ã¾ã™ã€‚å¾¡é‡ˆè¿¦æ§˜ã¯æ¥µæ¥½ã®è“®æ± ã®ãµã¡ã‚’ã€ç‹¬ã‚Šã§ã¶ã‚‰ã¶ã‚‰å¾¡æ­©ãã«ãªã£ã¦ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã—ãŸã€‚æ± ã®ä¸­ã«å’²ã„ã¦ã„ã‚‹è“®ã®èŠ±ã¯ã€ã¿ã‚“ãªç‰ã®ã‚ˆã†ã«ã¾ã£ç™½ã§ã€ãã®ã¾ã‚“ä¸­ã«ã‚ã‚‹é‡‘è‰²ã®è•Šã‹ã‚‰ã¯ã€ä½•ã¨ã‚‚äº‘ãˆãªã„å¥½ã„åŒ‚ãŒã€çµ¶é–“ãªãã‚ãŸã‚Šã¸æº¢ã‚Œã¦å±…ã‚Šã¾ã™ã€‚æ¥µæ¥½ã¯ä¸åº¦æœãªã®ã§ã”ã–ã„ã¾ã—ã‚‡ã†ã€‚", author: "èŠ¥å·é¾ä¹‹ä»‹", title: "èœ˜è››ã®ç³¸" },
  ],
  sunny: [
    { text: "ã•ã‚ã‚„ã‹ãªä¹æœˆä¸€æ—¥ã®æœã§ã—ãŸã€‚é’ãã‚‰ã§é¢¨ãŒã©ã†ã¨é³´ã‚Šã€æ—¥å…‰ã¯é‹å‹•å ´ã„ã£ã±ã„ã§ã—ãŸã€‚", author: "å®®æ²¢è³¢æ²»", title: "é¢¨ã®åˆä¸‰éƒ" },
    { text: "éœ§ãŒãµã£ã¨åˆ‡ã‚Œã¾ã—ãŸã€‚æ—¥ã®å…‰ãŒã•ã£ã¨æµã‚Œã¦ã¯ã„ã‚Šã¾ã—ãŸã€‚è‰ã‹ã‚‰ã¯ã—ãšããŒãã‚‰ãã‚‰è½ã¡ã€ã™ã¹ã¦ã®è‘‰ã‚‚èŒã‚‚èŠ±ã‚‚ã€ã“ã¨ã—ã®çµ‚ã‚ã‚Šã®æ—¥ã®å…‰ã‚’å¸ã£ã¦ã„ã¾ã™ã€‚", author: "å®®æ²¢è³¢æ²»", title: "é¢¨ã®åˆä¸‰éƒ" },
    { text: "ã“ã¨ã«é–€ã®ä¸Šã®ç©ºãŒã€å¤•ç„¼ã‘ã§ã‚ã‹ããªã‚‹æ™‚ã«ã¯ã€ãã‚ŒãŒèƒ¡éº»ã‚’ã¾ã„ãŸã‚ˆã†ã«ã¯ã£ãã‚Šè¦‹ãˆãŸã€‚", author: "èŠ¥å·é¾ä¹‹ä»‹", title: "ç¾…ç”Ÿé–€" },
  ],
  cloudy: [
    { text: "é›¨ã¯ã€ç¾…ç”Ÿé–€ã‚’ã¤ã¤ã‚“ã§ã€é ãã‹ã‚‰ã€ã–ã‚ã£ã¨äº‘ã†éŸ³ã‚’ã‚ã¤ã‚ã¦æ¥ã‚‹ã€‚å¤•é—‡ã¯æ¬¡ç¬¬ã«ç©ºã‚’ä½ãã—ã¦ã€è¦‹ä¸Šã’ã‚‹ã¨ã€é–€ã®å±‹æ ¹ãŒã€æ–œã«ã¤ãå‡ºã—ãŸç”ã®å…ˆã«ã€é‡ãŸãã†ã™æš—ã„é›²ã‚’æ”¯ãˆã¦ã„ã‚‹ã€‚", author: "èŠ¥å·é¾ä¹‹ä»‹", title: "ç¾…ç”Ÿé–€" },
    { text: "ãã‚Œã«ä¿„ã‹ã«é›²ãŒé‡ããªã£ãŸã®ã§ã™ã€‚ãã®é›²ã®ã©ã“ã‹ã‚‰ã‹ã€é›·ã®ä¸€åˆ‡ã‚Œã‚‰ã—ã„ã‚‚ã®ãŒã€ãŒãŸã£ã¨å¼•ãã¡ãã£ãŸã‚ˆã†ãªéŸ³ã‚’ãŸã¦ã¾ã—ãŸã€‚", author: "å®®æ²¢è³¢æ²»", title: "ã‚¬ãƒ‰ãƒ«ãƒ•ã®ç™¾åˆ" },
    { text: "ãã®ã¨ãã¯ã‚‚ã†ãã‚‰ãŒã„ã£ã±ã„ã®é»’ã„é›²ã§ã€æ¥Šã‚‚å¤‰ã«ç™½ã£ã½ããªã‚Šã€å±±ã®è‰ã¯ã—ã‚“ã—ã‚“ã¨ãã‚‰ããªã‚Šã€ãã“ã‚‰ã¯ãªã‚“ã¨ã‚‚è¨€ã‚ã‚Œãªã„æã‚ã—ã„æ™¯è‰²ã«ã‹ã‚ã£ã¦ã„ã¾ã—ãŸã€‚", author: "å®®æ²¢è³¢æ²»", title: "é¢¨ã®åˆä¸‰éƒ" },
  ],
  fog: [
    { text: "ç©ºã¯ãŸã„ã¸ã‚“æš—ãé‡ããªã‚Šã€ã¾ã‚ã‚ŠãŒã¼ã†ã£ã¨ã‹ã™ã‚“ã§æ¥ã¾ã—ãŸã€‚å†·ãŸã„é¢¨ãŒã€è‰ã‚’æ¸¡ã‚Šã¯ã˜ã‚ã€ã‚‚ã†é›²ã‚„éœ§ãŒåˆ‡ã‚Œåˆ‡ã‚Œã«ãªã£ã¦ç›®ã®å‰ã‚’ãã‚“ãã‚“é€šã‚Šéãã¦è¡Œãã¾ã—ãŸã€‚", author: "å®®æ²¢è³¢æ²»", title: "é¢¨ã®åˆä¸‰éƒ" },
    { text: "è‰ãŒã‹ã‚‰ã ã‚’æ›²ã’ã¦ã€ãƒ‘ãƒãƒ‘ãƒè¨€ã£ãŸã‚Šã€ã•ã‚‰ã•ã‚‰é³´ã£ãŸã‚Šã—ã¾ã—ãŸã€‚éœ§ãŒã“ã¨ã«æ»‹ããªã£ã¦ã€ç€ç‰©ã¯ã™ã£ã‹ã‚Šã—ã‚ã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚", author: "å®®æ²¢è³¢æ²»", title: "é¢¨ã®åˆä¸‰éƒ" },
    { text: "é»’æ¿ã‹ã‚‰é™ã‚‹ç™½å¢¨ã®ç²‰ã®ã‚ˆã†ãªã€æš—ã„å†·ãŸã„éœ§ã®ç²’ãŒã€ãã“ã‚‰ä¸€é¢è¸Šã‚Šã¾ã‚ã‚Šã€ã‚ãŸã‚ŠãŒã«ã‚ã‹ã«ã‚·ã‚¤ãƒ³ã¨ã—ã¦ã€é™°æ°—ã«é™°æ°—ã«ãªã‚Šã¾ã—ãŸã€‚è‰ã‹ã‚‰ã¯ã€ã‚‚ã†ã—ãšãã®éŸ³ãŒãƒã‚¿ãƒªãƒã‚¿ãƒªã¨èã“ãˆã¦æ¥ã¾ã™ã€‚", author: "å®®æ²¢è³¢æ²»", title: "é¢¨ã®åˆä¸‰éƒ" },
  ],
  drizzle: [
    { text: "æˆ–æ—¥ã®æš®æ–¹ã®äº‹ã§ã‚ã‚‹ã€‚ä¸€äººã®ä¸‹äººãŒã€ç¾…ç”Ÿé–€ã®ä¸‹ã§é›¨ã‚„ã¿ã‚’å¾…ã£ã¦ã„ãŸã€‚åºƒã„é–€ã®ä¸‹ã«ã¯ã€ã“ã®ç”·ã®ã»ã‹ã«èª°ã‚‚ã„ãªã„ã€‚", author: "èŠ¥å·é¾ä¹‹ä»‹", title: "ç¾…ç”Ÿé–€" },
    { text: "ç”³ã®åˆ»ä¸‹ã‚Šã‹ã‚‰ãµã‚Šå‡ºã—ãŸé›¨ã¯ã€ã„ã¾ã ã«ä¸Šã‚‹ã‘ã—ããŒãªã„ã€‚ãã“ã§ã€ä¸‹äººã¯ã€ä½•ã‚’ãŠã„ã¦ã‚‚å·®å½“ã‚Šæ˜æ—¥ã®æš®ã—ã‚’ã©ã†ã«ã‹ã—ã‚ˆã†ã¨ã—ã¦ã€ã¨ã‚Šã¨ã‚ã‚‚ãªã„è€ƒãˆã‚’ãŸã©ã‚ŠãªãŒã‚‰ã€ã•ã£ãã‹ã‚‰æœ±é›€å¤§è·¯ã«ãµã‚‹é›¨ã®éŸ³ã‚’ã€èãã¨ã‚‚ãªãèã„ã¦ã„ãŸã®ã§ã‚ã‚‹ã€‚", author: "èŠ¥å·é¾ä¹‹ä»‹", title: "ç¾…ç”Ÿé–€" },
    { text: "é›¨ãƒ‹ãƒ¢ãƒã‚±ã‚º\né¢¨ãƒ‹ãƒ¢ãƒã‚±ã‚º\né›ªãƒ‹ãƒ¢å¤ãƒæš‘ã‚µãƒ‹ãƒ¢ãƒã‚±ãƒŒ\nä¸ˆå¤«ãƒŠã‚«ãƒ©ãƒ€ãƒ²ãƒ¢ãƒ", author: "å®®æ²¢è³¢æ²»", title: "ã€”é›¨ãƒ‹ãƒ¢ãƒã‚±ã‚ºã€•" },
  ],
  rain: [
    { text: "é›¨ã¯ã€ç¾…ç”Ÿé–€ã‚’ã¤ã¤ã‚“ã§ã€é ãã‹ã‚‰ã€ã–ã‚ã£ã¨äº‘ã†éŸ³ã‚’ã‚ã¤ã‚ã¦æ¥ã‚‹ã€‚å¤•é—‡ã¯æ¬¡ç¬¬ã«ç©ºã‚’ä½ãã—ã¦ã€è¦‹ä¸Šã’ã‚‹ã¨ã€é–€ã®å±‹æ ¹ãŒã€æ–œã«ã¤ãå‡ºã—ãŸç”ã®å…ˆã«ã€é‡ãŸãã†ã™æš—ã„é›²ã‚’æ”¯ãˆã¦ã„ã‚‹ã€‚", author: "èŠ¥å·é¾ä¹‹ä»‹", title: "ç¾…ç”Ÿé–€" },
    { text: "ãã—ã¦é–“ã‚‚ãªãã€é›¨ã¨é»„æ˜ã¨ãŒã„ã£ã—ã‚‡ã«è¥²ã„ã‹ã‹ã£ãŸã®ã§ã™ã€‚å®Ÿã«ã¯ã’ã—ã„é›·é›¨ã«ãªã‚Šã¾ã—ãŸã€‚ã„ãªã³ã‹ã‚Šã¯ã€ã¾ã‚‹ã§ã“ã‚“ãªæ†ã‚Œãªæ—…ã®ã‚‚ã®ãªã©ã‚’æ¼‚ç™½ã—ã¦ã—ã¾ã„ãã†ã€ä¸¦æœ¨ã®é’ã„è‘‰ãŒã‚€ã—ã‚ƒãã—ã‚ƒã«ã‚€ã—ã‚‰ã‚Œã¦ã€é›¨ã®ã¤ã¶ã¨ä¸€ç·’ã«å …ã„ã¿ã¡ã‚’å©ãã€æã¾ã§ãŒã‚¬ãƒªã‚¬ãƒªå¼•ãè£‚ã‹ã‚Œã¦é™ã‚Šã‹ã‹ã‚Šã¾ã—ãŸã€‚", author: "å®®æ²¢è³¢æ²»", title: "ã‚¬ãƒ‰ãƒ«ãƒ•ã®ç™¾åˆ" },
    { text: "é›¨ãƒ‹ãƒ¢ãƒã‚±ã‚º\né¢¨ãƒ‹ãƒ¢ãƒã‚±ã‚º\né›ªãƒ‹ãƒ¢å¤ãƒæš‘ã‚µãƒ‹ãƒ¢ãƒã‚±ãƒŒ\nä¸ˆå¤«ãƒŠã‚«ãƒ©ãƒ€ãƒ²ãƒ¢ãƒ", author: "å®®æ²¢è³¢æ²»", title: "ã€”é›¨ãƒ‹ãƒ¢ãƒã‚±ã‚ºã€•" },
  ],
  snow: [
    { text: "æ´¥è»½ã®é›ª\nã“ãªé›ª ã¤ã¶é›ª ã‚ãŸé›ª ã¿ã¥é›ª\nã‹ãŸé›ª ã–ã‚‰ã‚é›ª ã“ã»ã‚Šé›ª", author: "å¤ªå®°æ²»", title: "æ´¥è»½" },
    { text: "å†¬ã€é›ªã®é™ã‚‹å¤œã‚‚ã€å‚˜ã‚’ã•ã—ã¦å¼Ÿã¨äºŒäººã§ã“ã®æ¡Ÿæ©‹ã«è¡Œã¤ãŸã€‚æ·±ã„æ¸¯ã®æµ·ã«ã€é›ªãŒã²ãã²ãé™ã¤ã¦ã‚ã‚‹ã®ã¯ã„ã„ã‚‚ã®ã ã€‚", author: "å¤ªå®°æ²»", title: "æ´¥è»½" },
    { text: "é›¨ãƒ‹ãƒ¢ãƒã‚±ã‚º\né¢¨ãƒ‹ãƒ¢ãƒã‚±ã‚º\né›ªãƒ‹ãƒ¢å¤ãƒæš‘ã‚µãƒ‹ãƒ¢ãƒã‚±ãƒŒ\nä¸ˆå¤«ãƒŠã‚«ãƒ©ãƒ€ãƒ²ãƒ¢ãƒ\næ…¾ãƒãƒŠã‚¯\næ±ºã‚·ãƒ†ç‹ãƒ©ã‚º\nã‚¤ãƒ„ãƒ¢ã‚·ãƒ…ã‚«ãƒ‹ãƒ¯ãƒ©ãƒƒãƒ†ãƒ°ãƒ«", author: "å®®æ²¢è³¢æ²»", title: "ã€”é›¨ãƒ‹ãƒ¢ãƒã‚±ã‚ºã€•" },
  ],
  thunder: [
    { text: "ã‘ã‚Œã©ã‚‚é–“ã‚‚ãªãå…¨ãã®å¤œã«ãªã‚Šã¾ã—ãŸã€‚ç©ºã®ã‚ã£ã¡ã§ã‚‚ã“ã£ã¡ã§ã‚‚ã€é›·ãŒç´ æ•µã«å¤§ããªå’†å“®ã‚’ã‚„ã‚Šã€é›»å…‰ã®ã›ã‚ã—ã„ã“ã¨ã¯ã¾ã‚‹ã§å¤œã®å¤§ç©ºã®æ„è­˜ã®æ˜æ»…ã®ã‚ˆã†ã§ã—ãŸã€‚", author: "å®®æ²¢è³¢æ²»", title: "ã‚¬ãƒ‰ãƒ«ãƒ•ã®ç™¾åˆ" },
    { text: "ã‘ã‚Œã©ã‚‚çª“ã®å¤–ã§ã¯ã€ã„ã£ã±ã„ã«å’²ã„ãŸç™½ç™¾åˆãŒã€åæœ¬ã°ã‹ã‚Šæ¯ã‚‚ã¤ã‘ãªã„åµã®ä¸­ã«ã€ãã®ç¨²å¦»ã®å…«åˆ†ä¸€ç§’ã‚’ã€ã¾ã‚‹ã§ã‹ãŒã‚„ã„ã¦ã˜ã£ã¨ç«‹ã£ã¦ã„ãŸã®ã§ã™ã€‚", author: "å®®æ²¢è³¢æ²»", title: "ã‚¬ãƒ‰ãƒ«ãƒ•ã®ç™¾åˆ" },
    { text: "ç¾ã—ã„ç™¾åˆã®æ†¤ã‚Šã¯é ‚ç‚¹ã«é”ã—ã€ç¼ç†±ã®èŠ±å¼ã¯é›ªã‚ˆã‚Šã‚‚å³ã‚ã—ãã€ã‚¬ãƒ‰ãƒ«ãƒ•ã¯ãã®å‡›ã¨å¼µã‚‹éŸ³ã•ãˆè´ã„ãŸã¨æ€ã„ã¾ã—ãŸã€‚æš—ãŒæ¥ãŸã¨æ€ã†é–“ã‚‚ãªãã€ã¾ãŸç¨²å¦»ãŒå‘ã†ã®ãã–ãã–ã®é›²ã‹ã‚‰ã€åŒ—æ–ã®å±±ä¸‹ç™½é›¨ã®ã‚ˆã†ã«èµ¤ãé€™ã£ã¦æ¥ã¦ã€è§¦ã‚Œãªã„å…‰ã®æ‰‹ã‚’ã‚‚ã£ã¦ã€ç™¾åˆã‚’æ“¦ã‚ã¦éãã¾ã—ãŸã€‚", author: "å®®æ²¢è³¢æ²»", title: "ã‚¬ãƒ‰ãƒ«ãƒ•ã®ç™¾åˆ" },
  ],
};

const weatherMeta = {
  clear:   { icon: "â˜€ï¸", name: "å¿«æ™´" },
  sunny:   { icon: "ğŸŒ¤ï¸", name: "æ™´ã‚Œ" },
  cloudy:  { icon: "â˜ï¸", name: "æ›‡ã‚Š" },
  fog:     { icon: "ğŸŒ«ï¸", name: "éœ§" },
  drizzle: { icon: "ğŸŒ¦ï¸", name: "éœ§é›¨" },
  rain:    { icon: "ğŸŒ§ï¸", name: "é›¨" },
  snow:    { icon: "â„ï¸", name: "é›ª" },
  thunder: { icon: "âš¡", name: "é›·é›¨" },
};

const DAYS = ["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"];
const categories = Object.keys(weatherMeta);

function getWeatherCategory(code) {
  if (code === 0) return "clear";
  if (code <= 2) return "sunny";
  if (code === 3) return "cloudy";
  if (code >= 45 && code <= 48) return "fog";
  if (code >= 51 && code <= 57) return "drizzle";
  if (code >= 61 && code <= 67) return "rain";
  if (code >= 71 && code <= 77) return "snow";
  if (code >= 80 && code <= 82) return "rain";
  if (code >= 85 && code <= 86) return "snow";
  if (code >= 95) return "thunder";
  return "cloudy";
}

function pick(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

function formatDate(d) {
  return `${String(d.getMonth()+1).padStart(2,"0")}/${String(d.getDate()).padStart(2,"0")}ï¼ˆ${DAYS[d.getDay()]}ï¼‰`;
}

// --- ç”»é¢æç”» ---
function render(category, tempC, quote, hourlyItems, locationName, high, low) {
  document.getElementById("location-info").textContent = locationName;
  document.getElementById("weather-icon").textContent = weatherMeta[category].icon;
  document.getElementById("temperature").textContent = tempC + "Â°C";
  document.getElementById("quote-text").innerHTML = quote.text.replace(/\n/g, "<br>");
  document.getElementById("quote-author").textContent = quote.author;
  document.getElementById("quote-title").textContent = quote.title;

  const now = new Date();
  document.getElementById("footer-date").innerHTML =
    `<span>${formatDate(now)}</span><span>${high}ã€€${low}</span>`;

  const container = document.getElementById("hourly");
  container.innerHTML = "";
  hourlyItems.forEach((item, i) => {
    const el = document.createElement("div");
    el.className = "hour-item" + (i === 0 ? " now" : "");
    const precipHtml = item.precip != null ? `<div class="hour-precip">${item.precip}%</div>` : "";
    el.innerHTML =
      `<div class="hour-label">${item.label}</div>` +
      `<div class="hour-icon">${item.icon}</div>` +
      `<div class="hour-temp">${item.temp}Â°C</div>` +
      precipHtml;
    container.appendChild(el);
  });

  document.body.className = "weather-" + category;
}

// --- å³åº§ã«ãƒ‡ãƒ¢è¡¨ç¤ºï¼ˆAPIå¾…ã¡ãªã—ï¼‰ ---
const now = new Date();
const demoCat = pick(categories);
const demoTemp = Math.floor(Math.random() * 30) - 5;
const demoQuote = pick(quotes[demoCat]);
const demoHourly = [];
for (let i = 0; i < 24; i++) {
  const h = (now.getHours() + i) % 24;
  const c = pick(categories);
  demoHourly.push({
    label: i === 0 ? "ç¾åœ¨" : h + "æ™‚",
    icon: weatherMeta[c].icon,
    temp: demoTemp + Math.floor(Math.random() * 6) - 3,
    precip: Math.floor(Math.random() * 80),
  });
}
render(demoCat, demoTemp, demoQuote, demoHourly, "æ±äº¬éƒ½", demoTemp + 5, demoTemp - 3);

// --- APIã§å®Ÿãƒ‡ãƒ¼ã‚¿ã«å·®ã—æ›¿ãˆ ---
(async function () {
  try {
    // ä½ç½®æƒ…å ±ã‚’è©¦ã¿ã‚‹ï¼ˆ3ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰
    let lat = 35.6762, lon = 139.6503;
    try {
      const pos = await new Promise((ok, ng) => {
        if (!navigator.geolocation) { ng(); return; }
        const t = setTimeout(ng, 3000);
        navigator.geolocation.getCurrentPosition(
          p => { clearTimeout(t); ok(p); },
          () => { clearTimeout(t); ng(); },
          { timeout: 3000, maximumAge: 300000 }
        );
      });
      lat = pos.coords.latitude;
      lon = pos.coords.longitude;
    } catch { /* æ±äº¬ã®ã¾ã¾ */ }

    // å¤©æ°—API
    const ctrl = new AbortController();
    const timer = setTimeout(() => ctrl.abort(), 8000);
    const url =
      `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}` +
      `&current_weather=true&timezone=auto&hourly=temperature_2m,weather_code,precipitation_probability&forecast_days=2`;
    const res = await fetch(url, { signal: ctrl.signal });
    clearTimeout(timer);
    if (!res.ok) return;
    const data = await res.json();

    const weather = data.current_weather;
    const category = getWeatherCategory(weather.weathercode);
    const quote = pick(quotes[category] || quotes.cloudy);
    const curHour = now.getHours();
    const temps = data.hourly.temperature_2m;
    const high = Math.round(Math.max(...temps));
    const low = Math.round(Math.min(...temps));

    const hourlyItems = [];
    const precipData = data.hourly.precipitation_probability || [];
    for (let i = 0; i < 24; i++) {
      const idx = curHour + i;
      if (idx >= data.hourly.time.length) break;
      const c = getWeatherCategory(data.hourly.weather_code[idx]);
      hourlyItems.push({
        label: i === 0 ? "ç¾åœ¨" : (idx % 24) + "æ™‚",
        icon: weatherMeta[c].icon,
        temp: Math.round(data.hourly.temperature_2m[idx]),
        precip: precipData[idx] != null ? precipData[idx] : null,
      });
    }

    render(category, Math.round(weather.temperature), quote, hourlyItems, "æ±äº¬éƒ½", high, low);

    // åœ°åã‚’å¾Œã‹ã‚‰å–å¾—
    try {
      const ctrl2 = new AbortController();
      const t2 = setTimeout(() => ctrl2.abort(), 3000);
      const geoRes = await fetch(
        `https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json&accept-language=ja&zoom=10`,
        { signal: ctrl2.signal }
      );
      clearTimeout(t2);
      if (geoRes.ok) {
        const geo = await geoRes.json();
        const a = geo.address;
        if (a) {
          const pref = a.province || a.state || "";
          const city = a.city || a.town || a.village || a.county || "";
          if (pref || city) {
            document.getElementById("location-info").textContent =
              pref && city ? pref + " " + city : pref || city;
          }
        }
      }
    } catch { /* åœ°åå–å¾—å¤±æ•—ã¯ç„¡è¦– */ }

  } catch { /* APIå…¨ä½“ãŒå¤±æ•—ã—ã¦ã‚‚ãƒ‡ãƒ¢è¡¨ç¤ºã®ã¾ã¾ */ }
})();
</script>
</body>
</html>
